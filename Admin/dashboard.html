<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard | Admin (Smart Pagination + Search)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex">

  <!-- Sidebar -->
  <aside class="w-64 bg-orange-500 text-white flex flex-col p-5">
    <div class="text-2xl font-bold mb-8">Sunstar Elevator</div>
    <nav class="flex flex-col space-y-4">
      <a href="#" class="hover:bg-orange-600 py-2 px-3 rounded"> Dashboard</a>
      <a href="#" class="hover:bg-orange-600 py-2 px-3 rounded"> New Installation</a>
      <a href="#" class="hover:bg-orange-600 py-2 px-3 rounded"> Maintenance</a>
      <a href="#" class="hover:bg-orange-600 py-2 px-3 rounded"> Service History</a>
      <a href="#" class="hover:bg-orange-600 py-2 px-3 rounded"> Technicians</a>
      <a href="#" class="hover:bg-orange-600 py-2 px-3 rounded"> Settings</a>
    </nav>

    <div class="mt-auto pt-6 border-t border-orange-300">
      <a href="login.html" class="block hover:bg-orange-600 py-2 px-3 rounded text-center"> Logout</a>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-8 bg-gradient-to-br from-orange-100 via-yellow-50 to-white min-h-screen">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold text-gray-700">Dashboard Overview</h1>
      <div class="flex items-center space-x-4">
        <span class="text-gray-600 font-medium">Hello, Safin</span>
        <img src="https://ui-avatars.com/api/?name=Safin+Ahmed" alt="User" class="w-10 h-10 rounded-full border">
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="bg-white p-5 rounded-xl shadow-md border-t-4 border-orange-500">
        <h3 class="text-gray-600">Total Installations</h3>
        <p class="text-2xl font-bold text-gray-800 mt-2">128</p>
      </div>
      <div class="bg-white p-5 rounded-xl shadow-md border-t-4 border-orange-500">
        <h3 class="text-gray-600">Pending Requests</h3>
        <p class="text-2xl font-bold text-gray-800 mt-2">23</p>
      </div>
      <div class="bg-white p-5 rounded-xl shadow-md border-t-4 border-orange-500">
        <h3 class="text-gray-600">Active Technicians</h3>
        <p class="text-2xl font-bold text-gray-800 mt-2">12</p>
      </div>
    </div>

    <!-- Recent Requests (with smart pagination & search) -->
    <div class="bg-white p-6 rounded-xl shadow-md">

      <!-- Top bar: Pagination Left + Search Right -->
      <div class="flex justify-between items-center mb-4">

        <!-- Pagination (Left) -->
        <div class="flex items-center space-x-3">
          <button id="prevBtn" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">Prev</button>

          <span id="pageInfo" class="text-gray-700 font-medium">
            Page <span id="currentPage" class="font-semibold">1</span> of <span id="totalPages" class="font-semibold">1</span>
          </span>

          <button id="nextBtn" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">Next</button>

          <!-- Page number selector -->
          <select id="pageSelect" class="border border-gray-300 rounded px-2 py-1 text-gray-700">
            <!-- dynamically populated -->
          </select>
        </div>

        <!-- Search Bar (Right) -->
        <div class="flex items-center gap-3">
          <input id="searchInput" 
            type="text" 
            placeholder="Search requests (ID, name, type, status, date)..." 
            class="border border-gray-300 rounded px-3 py-2 w-80 focus:ring-2 focus:ring-orange-400 focus:outline-none"
          >
          <select id="statusFilter" class="border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-orange-400">
            <option value="">All Status</option>
            <option value="Pending">Pending</option>
            <option value="In Progress">In Progress</option>
            <option value="Completed">Completed</option>
          </select>
        </div>
      </div>

      <table id="requestsTable" class="w-full text-left border-collapse">
        <thead>
          <tr class="bg-gray-200 text-gray-600 uppercase text-sm">
            <th class="py-3 px-4">Request ID</th>
            <th class="py-3 px-4">Customer Name</th>
            <th class="py-3 px-4">Type</th>
            <th class="py-3 px-4">Status</th>
            <th class="py-3 px-4">Date</th>
          </tr>
        </thead>

        <tbody id="tableBody" class="text-gray-700">
          <!-- rows injected by JS -->
        </tbody>
      </table>

      <!-- Smart pagination controls (bottom) -->
      <div id="paginationControls" class="flex justify-center items-center mt-6 space-x-2">
        <!-- page buttons injected by JS -->
      </div>
    </div>
  </main>

  <script>
    /*************************************************************************
     * CONFIG
     *************************************************************************/
    const pageSize = 10; // rows per page
    // sample static data (57 items) - replace with API later
    const data = (() => {
      const types = ['Installation','Maintenance','Repair','Modification'];
      const statuses = ['Pending','In Progress','Completed'];
      const names = ['Rafiq Islam','Nasrin Akter','Shahin Alam','Md. Rahim','Mr. Karim','Mrs. Laila','Sadia','Tania','Hasan','Karim','Bashar','Rana','Monir','Farah','Nazmul','Anika','Sabbir','Jahid','Arman','Sohana'];
      const list = [];
      const start = new Date(2025,6,1); // Jul 1, 2025
      for (let i=1;i<=57;i++) {
        const id = 'REQ-' + String(1000+i);
        const name = names[i % names.length];
        const type = types[i % types.length];
        const status = statuses[i % statuses.length];
        const d = new Date(start.getTime() + (i*24*60*60*1000));
        const date = d.toISOString().slice(0,10);
        list.push({ id, customer: name, type, status, date });
      }
      return list;
    })();

    /*************************************************************************
     * STATE
     *************************************************************************/
    let filtered = [...data]; // filtered dataset according to search/filters
    let currentPage = 1;
    let totalPages = Math.max(1, Math.ceil(filtered.length / pageSize));

    /*************************************************************************
     * DOM refs
     *************************************************************************/
    const tableBody = document.getElementById('tableBody');
    const currentPageEl = document.getElementById('currentPage');
    const totalPagesEl = document.getElementById('totalPages');
    const pageSelect = document.getElementById('pageSelect');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const paginationControls = document.getElementById('paginationControls');
    const searchInput = document.getElementById('searchInput');
    const statusFilter = document.getElementById('statusFilter');

    /*************************************************************************
     * HELPERS
     *************************************************************************/
    function renderTable(page = 1) {
      tableBody.innerHTML = '';
      currentPage = Math.max(1, Math.min(page, totalPages));
      const start = (currentPage - 1) * pageSize;
      const pageData = filtered.slice(start, start + pageSize);

      if (pageData.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="5" class="py-6 px-4 text-center text-gray-500">No records found.</td></tr>';
        return;
      }

      for (const row of pageData) {
        const tr = document.createElement('tr');
        tr.className = 'border-b hover:bg-gray-50';
        tr.innerHTML = `
          <td class="py-3 px-4 font-mono">${row.id}</td>
          <td class="py-3 px-4">${row.customer}</td>
          <td class="py-3 px-4">${row.type}</td>
          <td class="py-3 px-4">${statusBadge(row.status)}</td>
          <td class="py-3 px-4">${row.date}</td>
        `;
        tableBody.appendChild(tr);
      }
    }

    function statusBadge(status) {
      if (status === 'Pending') return '<span class="bg-yellow-200 text-yellow-700 px-2 py-1 rounded text-sm">Pending</span>';
      if (status === 'In Progress') return '<span class="bg-blue-200 text-blue-700 px-2 py-1 rounded text-sm">In Progress</span>';
      if (status === 'Completed') return '<span class="bg-green-200 text-green-700 px-2 py-1 rounded text-sm">Completed</span>';
      return `<span class="px-2 py-1 rounded text-sm">${status}</span>`;
    }

    // Render page selector (dropdown)
    function renderPageSelect() {
      pageSelect.innerHTML = '';
      for (let i=1;i<=totalPages;i++){
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = 'Page ' + i;
        if (i === currentPage) opt.selected = true;
        pageSelect.appendChild(opt);
      }
    }

    // Smart pagination list with ellipsis
    function getSmartPages(total, current, maxButtons = 7) {
      // returns array like [1, '...', 8,9,10,11,12, '...', 20]
      if (total <= maxButtons) return Array.from({length: total}, (_,i) => i+1);
      const pages = [];
      const side = Math.floor((maxButtons - 3) / 2); // pages on each side of current
      const left = Math.max(2, current - side);
      const right = Math.min(total - 1, current + side);

      pages.push(1);
      if (left > 2) pages.push('left-ellipsis');

      for (let i = left; i <= right; i++) pages.push(i);

      if (right < total - 1) pages.push('right-ellipsis');
      pages.push(total);
      return pages;
    }

    // Render pagination controls (bottom)
    function renderPaginationControls() {
      paginationControls.innerHTML = '';
      const pages = getSmartPages(totalPages, currentPage, 9); // adjust maxButtons for width

      // Prev
      const prev = document.createElement('button');
      prev.className = 'px-3 py-1 bg-gray-200 rounded hover:bg-gray-300';
      prev.textContent = 'Prev';
      prev.disabled = currentPage === 1;
      if (prev.disabled) prev.classList.add('opacity-50','cursor-not-allowed');
      prev.addEventListener('click', () => goToPage(currentPage - 1));
      paginationControls.appendChild(prev);

      // page buttons / ellipsis
      for (const p of pages) {
        if (p === 'left-ellipsis' || p === 'right-ellipsis') {
          const span = document.createElement('span');
          span.className = 'px-2 text-gray-500';
          span.textContent = '...';
          paginationControls.appendChild(span);
          continue;
        }

        const btn = document.createElement('button');
        btn.className = 'px-3 py-1 rounded hover:bg-gray-200';
        if (p === currentPage) {
          btn.className = 'px-3 py-1 bg-orange-500 text-white rounded';
        } else {
          btn.classList.add('bg-gray-100','text-gray-700');
        }
        btn.textContent = p;
        btn.addEventListener('click', () => goToPage(p));
        paginationControls.appendChild(btn);
      }

      // Next
      const next = document.createElement('button');
      next.className = 'px-3 py-1 bg-gray-200 rounded hover:bg-gray-300';
      next.textContent = 'Next';
      next.disabled = currentPage === totalPages;
      if (next.disabled) next.classList.add('opacity-50','cursor-not-allowed');
      next.addEventListener('click', () => goToPage(currentPage + 1));
      paginationControls.appendChild(next);
    }

    /*************************************************************************
     * ACTIONS
     *************************************************************************/
    function goToPage(page) {
      if (page < 1) page = 1;
      if (page > totalPages) page = totalPages;
      currentPage = page;
      updateUI();
    }

    function updateUI() {
      totalPages = Math.max(1, Math.ceil(filtered.length / pageSize));
      // clamp currentPage
      if (currentPage > totalPages) currentPage = totalPages;
      currentPageEl.textContent = currentPage;
      totalPagesEl.textContent = totalPages;
      renderTable(currentPage);
      renderPageSelect();
      renderPaginationControls();
      // update pageSelect value (if different)
      pageSelect.value = currentPage;
    }

    // apply search + filters to 'data' -> filtered array
    function applyFilters() {
      const q = searchInput.value.trim().toLowerCase();
      const status = statusFilter.value;
      if (!q && !status) {
        filtered = [...data];
      } else {
        filtered = data.filter(item => {
          // search across fields
          const combined = `${item.id} ${item.customer} ${item.type} ${item.status} ${item.date}`.toLowerCase();
          const matchesQuery = q ? combined.includes(q) : true;
          const matchesStatus = status ? item.status === status : true;
          return matchesQuery && matchesStatus;
        });
      }
      currentPage = 1;
      updateUI();
    }

    /*************************************************************************
     * EVENTS
     *************************************************************************/
    prevBtn.addEventListener('click', () => goToPage(currentPage - 1));
    nextBtn.addEventListener('click', () => goToPage(currentPage + 1));

    pageSelect.addEventListener('change', (e) => {
      goToPage(Number(e.target.value));
    });

    searchInput.addEventListener('input', () => {
      // small debounce
      clearTimeout(searchInput._debounce);
      searchInput._debounce = setTimeout(applyFilters, 200);
    });

    statusFilter.addEventListener('change', applyFilters);

    /*************************************************************************
     * INITIAL RENDER
     *************************************************************************/
    updateUI();

    // Expose for debugging (optional)
    window.__dashboard = { data, applyFilters, goToPage };
  </script>
</body>
</html>
